---
- hosts: '{{host_to_deploy}}'
  vars:
          - app_root: '/opt/globo/{{app}}/{{version}}/'


  tasks:        
          - name: Create app directory if it does not exist
            file:
             path: '{{app_root}}'
             state: directory
             mode: 0744
          
          - name: Copy app files into host/app_root 
            copy: 
             src: ../app
             dest: '{{app_root}}'
             mode: '0744'

          - name: Copy docker image files into host/app_root
            copy:
             src: ../docker_image/Dockerfile
             dest: '{{app_root}}'
             mode: '0744'

          - name: Copy docker image files into host/app_root
            copy:
             src: ../docker_image/gunicorn_start.sh
             dest: '{{app_root}}'
             mode: '0744'

          - name: Stop application if it was already deployed before (previous version)
            shell: docker stop '{{app}}'    

            #- name: Build and run docker image with app inside it
            #TODO
            #- name: Test app is LISTENING at defined port
            #TODO
            #- name: CFM - publish the version deployed, host, date and time.
            #TODO
